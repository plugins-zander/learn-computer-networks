# IP数据报

![img](https://img1.zlogs.net/20/20200115191435.png)

- 版本

  - 4bit
  - 指 IP 协议的版本目前的 IP 协议版本号为 4 (即 IPv4)

- 首部长度

  - 4 bit
  - 可表示的最大数值是 15 个单位(一个单位为 4 字节)
  - 因此 IP 的首部长度的最大值是 60 字节。

- 区分服务

  - 8bir，用来获得更好的服务
  - 在旧标准中叫做服务类型，但实际上一直未被使用过。
  - 1998 年这个字段改名为区分服务。
  - 只有在使用区分服务（DiffServ）时，这个字段才起作用。
  - 在一般的情况下都不使用这个字段

- 总长度

  - 16bit，指首部和数据之和的长度，
  - 单位为字节，因此数据报的最大长度为 65535 字节。
  - 总长度必须不超过最大传送单元 MTU。

- 标识

  - 16bit
  - 它是一个计数器，用来产生数据报的标识。

- 标志

  - 3bit，但目前只有两个标志位有意义。

  - 图示

    - 

      ![img](https://img1.zlogs.net/20/20200115191436.png)

  - MF (More Fragment) ：

    - 1 表示后面“还有分片”， 0 表示最后一个分片。

  - DF (Don‘t Fragment) ：

    - 0 允许分片，1不允许分片

- 片偏移

  - 13bit

  - 较长的分组在分片后，某片在原分组中的相对位置。

  - 片偏移以 8 个字节为偏移单位。

  - 【例5-1】 IP 数据报分片举例

    - 假定一个IP数据报的总长度为3620字节，其数据部分长度为3600字节(使用固定长度首部)，需要分片为长度不超过1420字节的数据报片。因首部固定长度部分为20字节，因此每个数据报分片的数据部分长度不能超过1400字节。于是分为3个数据报片，其数据部分的长度分别为1400， 1400和800字节。初始数据报的首部被复制为各数据报分片的首部，但必须修改有关字段的值。

    - 图示

      - 

        ![img](https://img1.zlogs.net/20/20200115191437.png)

        ![img](https://img1.zlogs.net/20/20200115191438.png)

- 生存时间

  - 8bit，记为 TTL (Time To Live)
  - 数据报在网络中可通过的路由器数的最大值。

- 协议

  - 8bit

  - 指出此数据报携带的数据使用何种协议

  - 以便目的主机的 IP 层将数据部分上交给哪个处理过程

  - 图示

    - 

      ![img](https://img1.zlogs.net/20/20200115191439.png)

- 首部检验和

  - 16bit

  - 只检验数据报的首部，不检验数据部分。

  - 这里不采用 CRC 检验码而采用简单的计算方法

  - 图示

    - 

      ![img](https://img1.zlogs.net/20/20200115191440.png)

- 源地址和目的地址

  - 都各占 4bit

- 可变部分

  - 可变部分就是一个选项字段
  - IP 首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富。
  - 选项字段的长度可变，从 1 个字节到 40 个字节不等，取决于所选择的项目。
  - 某些选项项目只需要1个字节，它只包括1个字节的选项代码。但还有些选项需要多个字节，这些选项一个个拼接起来，中间不需要有分隔符。
  - 目前，这些任选项定义如下：
    - ①安全和处理限制，用于军事领域；
    - ②记录路径，让每个路由器都记下它的IP地址；
    - ③时间戳（Time Stamp），让每个路由器都记下IP数据报经过每一个路由器的IP地址和当地时间；
    - ④宽松的源站路由（Loose Source Route），为数据报指定一系列必须经过的IP地址；
    - ⑤严格的源站路由（Strict Source Route），与宽松的源站路由类似，但是要求只能经过指定的这些地址，不能经过其他的地址。

- 填充

  - IP 数据报首部最后需用全0的填充字段补齐成为4字节的整数倍。