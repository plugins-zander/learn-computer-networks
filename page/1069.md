

## RIP路由协议



### RIP协议概述

路由信息协议( routing information protocol，RIP)是IP网络中使用得最早、应用最广泛的AS内部路由选择协议。

RIP是一种分布式的基于距离向量的路由选择协议，是因特网的标准协议。

在RFC 1058中定义了RIPv1版本， RFC 2453中定义了它的向后兼容版本RIPv2。

RIPv1使用跳数(hop count)作为费用测度，即将每条链路的费用均设为1。 

> 路由器，路口

跳数是沿着从源路由器到目的子网（包括目的子网）的最短路所经过的子网数量，IP数据报每经过一台路由器，跳数就加1。



“距离”的定义

从一个路由器到直接连接的网络的距离定义为 1。

从一个路由器到非直接连接的网络的距离定义为所经过的路由器个数加 1。

RIP 协议中的“距离”也称为“跳数”(hop count)，因为每经过一个路由器，跳数就加 1。

> 路由器个数，即加入第一个路由器

这里的“距离”实际上指的是“最短距离”， （最少的跳数）



RIP 认为一个好的路由就是它通过的路由器的数目少，即“距离短”。

RIP 允许一条路径最多只能包含 15 个路由器。

“距离”的最大值为16 时即相当于不可达。可见 RIP 只适用于小型互联网。

RIP 不能在两个网络之间同时使用多条路由。RIP 选择一个具有最少路由器的路由（即最短路由），哪怕还存在另一条高速(低时延)但路由器较多的路由。   

> 最少路由优先

RIP 协议的三个要点 

仅和相邻路由器交换信息。 

> 经过什么，可以到达什么

交换的信息是当前本路由器所知道的全部信息，即自己的路由表。 

按固定的时间间隔交换路由信息(如每隔 30 秒)。 



路由表的建立 

路由器在刚刚开始工作时，只知道到直接连接的网络的距离（此距离定义为1）。
以后，每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。
经过若干次更新后，所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址。
RIP 协议的收敛(convergence)过程较快，即在自治系统中所有的结点都得到正确的路由选择信息的过程。 

> 出错过程较慢，即发现错误信息时



距离向量（Ford-Fulkerson ）算法

收到相邻路由器（其地址为 X）的一个 RIP 报文：

(1) 先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。

(2) 对修改后的 RIP 报文中的每一个项目，重复以下步骤：

若项目中的目的网络不在路由表中，则把该项目添加到路由表中。
否则若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。
否则若收到项目中的距离小于路由表中的距离，则进行更新，
否则，什么也不做。

(3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为16（距离为16表示不可达）。

> 则中间隔着一个，要想知道坏了，至少3.5分钟

(4) 返回。







路由器之间交换信息 

RIP协议让互联网中的所有路由器都和自己的相邻路由器不断交换路由信息，并不断更新其路由表，使得从每一个路由器到每一个目的网络的路由都是最短的（即跳数最少）。

虽然所有的路由器最终都拥有了整个自治系统的全局路由信息，但由于每一个路由器的位置不同，它们的路由表当然也应当是不同的。  



![](https://img1.zlogs.net/19/20191126084140.png)

刚开始加电时的路由表

![](https://img1.zlogs.net/19/20191126084358.png)

第一次更新路由表

> 下一跳，下一个路由器



![](https://img1.zlogs.net/19/20191126090439.png)



第二次更新路由表



### RIP2 协议的报文格式

![](https://img1.zlogs.net/19/20191126090549.png)

RIP2 的报文由首部和路由部分组成。

RIP2 报文中的路由部分由若干个路由信息组成。每个路由信息需要用 20 个字节。地址族标识符（又称为地址类别）字段用来标志所使用的地址协议。

路由标记填入自治系统的号码，这是考虑使RIP 有可能收到本自治系统以外的路由选择信息。再后面指出某个网络地址、该网络的子网掩码、下一跳路由器地址以及到此网络的距离。  



### RIP 协议的优缺点

```
RIP 存在的一个问题是当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。
RIP 协议最大的优点就是实现简单，开销较小。
RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。   

```



### RIPv 1与RIPv2的比较

（1）RIPv1是有类路由(classful)协议，它们在宣告路由信息时不携带网络掩码。RIPv2是无类路由(classless)协议，它们在宣告路由信息时携带网络掩码。

> v1相当于默认掩码B-255.255.0.0

（2）RIPv1是广播发送RIP报文，广播地址为255. 255. 255. 255。RIPv2支持广播也支持多播发送RIP报文，多播地址为224.0.0.9。发送广播是给所有路由器包括网络中的主机，而多播只发送给使用该协议的路由器。与广播相比多播明显节省带宽。

> v1主机会收到报文，V2只有路由器会收到



### RIP路由自环分析

由于RIP距离向量路由选择算法有一个慢收敛问题

路由选择协议更新信息时具有好消息传播得快，而坏消息传播得慢的特点。

这个问题将导致不一致性产生，从而产生路由自环。

> 只有R1最先知道，其他都要加到16才知道



### RIP协议使用以下机制减少路由自环

（1）水平分割。

（2）毒化翻转。

（3）保持定时器法。

（4）触发更新法。



##