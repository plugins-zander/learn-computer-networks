# TCP拥塞控制的实现

## 拥塞控制的概念

- 在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏——产生拥塞(congestion)。
- 出现资源拥塞的条件：
  - 对资源需求的总和 > 可用资源
- 若网络中有许多资源同时产生拥塞，网络的性能就要明显变坏，整个网络的吞吐量将随输入负荷的增大而下降。
- 发送端的主机在确定发送报文段的速率时，既要考虑接收端的接收能力，又要从全局出发考虑不要使网络发生拥塞。
  - （1）接收端窗口$W_R$(receiver window)，又称为通知窗口（advertised window），是接收端根据其目前的接收缓存大小所许诺的最新的窗口值，是来自接收端的流量控制。接收端将此窗口值放在TCP报文首部中的窗口字段，传送给发送端。
  - （2）拥塞窗口$W_C$(congestion window)，是发送端根据自己估计的网络拥塞程度而设置的窗口值，是来自发送端的拥塞控制。
- 发送端的发送窗口的上限值应当取为接收端窗口rwnd和拥塞窗口cwnd这两个变量中较小的一个，即：
  - 发送窗口的上限值=Min($W_R$，$W_C$)          （6-6）
  - 当$W_R$ < $W_C$时，是接收端的接收能力限制发送窗口的上限值。当$W_C$< $W_R$时，则是网络的拥塞限制发送窗口的上限值。

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223182727.png)

拥塞控制所起的作用



## 慢开始和拥塞避免

- 慢开始

  - 在主机刚刚开始发送报文段时，可先将拥塞窗口WC设置为一个最大报文段MSS的大小。在每收到一个对新的报文段的确认后，将拥塞窗口增加至两个MSS的数值。用这样的方法逐步增大发送端的拥塞窗口WC，可以使分组注入网络的速率更加合理。

- 慢开始和拥塞避免算法实现举例

  ![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223182817.png)

  ![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223182907.png)

  

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223183831.png)

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223183900.png)

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223183930.png)

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191223183958.png)





```
乘法减小(multiplicative decrease) 

“乘法减小“是指不论在慢开始阶段还是拥塞避免阶段，只要出现一次超时（即出现一次网络拥塞），就把慢开始门限值 ssthresh 设置为当前的拥塞窗口值乘以 0.5。
当网络频繁出现拥塞时，ssthresh 值就下降得很快，以大大减少注入到网络中的分组数。 

```

```
加法增大(additive increase) 
“加法增大”是指执行拥塞避免算法后，在收到对所有报文段的确认后（即经过一个往返时间），就把拥塞窗口 cwnd增加一个 MSS 大小，使拥塞窗口缓慢增大，以防止网络过早出现拥塞。 

```

```
“拥塞避免”并非指完全能够避免了拥塞。利用以上的措施要完全避免网络拥塞还是不可能的。
“拥塞避免”是说在拥塞避免阶段把拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞。 

```













## 快重传和快恢复

- 快重传算法规定，发送端只要一连收到3个重复的ACK即可断定有分组丢失了，就应立即重传丢失的报文段，而不必继续等待为该报文段设置的重传计时器的超时

- 不难看出，快重传并非取消重传计时器，而是在某些情况下可更早地重传丢失的报文段。

- 快重传举例

  - 

    ![img](https://mubu.com/document_image/074a7d6c-5e3a-47a4-b4cd-87da3937a006-4644403.jpg)







### 快重传和快恢复算法

- （1）当发送端收到连续3个重复的ACK时，就重新设置慢开始门限Sstresh。
- （2）与慢开始不同之处是拥塞窗口WC不是设置为1，而是设置为慢开始门限Sstresh 减半后的数值，然后开始执行拥塞避免算法（“加法增大”），使拥塞窗口缓慢地线性增大。
- （3）若发送窗口值还允许发送报文段，就按拥塞避免算法继续发送报文段。

### 快重传和快恢复算法的实现举例

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191217082235.png)