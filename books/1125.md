# FTP服务

## 文件传输协议概述

- 文件传输协议(File Transfer Protocol，FTP)是用于在网络上进行文件传输的一套标准协议。
- 文件传送协议能把多种类型的文件或文档从不同厂家生产的计算机、手机等智能终端通过有线或无线的计算机网络发送（复制）到远程的另一台计算机、手机等智能设备中。
- 文件传送并非很简单的问题
  - FTP是网络环境中的一项基本应用。
  - 初看起来，在两个主机之间传送文件似乎是很简单的事情。
  - 其实不然，原因是众多的  计算机厂商研制出的文件系统种类繁多，且差别非常大。
- 网络环境下复制文件的复杂性
  - （1）计算机存储数据的格式不同。
  - （2）文件的目录结构和文件命名的规定不同。
  - （3）对于相同的文件存取功能，操作系统使用的命令不同。
  - （4）访问控制方法不同。

## FTP协议的特点

- （1） FTP只提供文件传送的一些基本的服务，它使用TCP可靠的传输服务。
- （2）FTP的主要功能是减少或消除在不同操作系统下处理文件的不兼容性。
- （3）FTP使用客户／服务器方式。一个FTP服务器进程可同时为多个客户进程提供服务。FTP的服务器进程由两大部分组成：主进程负责接受新的请求，其他的若干个从属进程负责处理单个请求。

## 主进程的工作步骤

- （1）打开熟知端口（端口号为21），使客户进程能够连接上。
- （2）等待客户进程发出连接请求。
- （3）启动从属进程来处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
- （4）回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发地进行的。

## FTP 使用的两个 TCP 连接

- 

  ![img](https://mubu.com/document_image/3b293be5-e33c-4bcb-a305-047d78783f93-4644403.jpg)

## 两个不同的端口号

- 当客户进程向服务器进程发出建立连接请求时，要寻找连接服务器进程的熟知端口(21)，同时还要告诉服务器进程自己的另一个端口号码，用于建立数据传送连接。
- 接着，服务器进程用自己传送数据的熟知端口(20)与客户进程所提供的端口号码建立数据传送连接。
- 由于 FTP 使用了两个不同的端口号，所以数据连接与控制连接不会发生混乱。

- 使用两个不同端口号的好处 

  - 使协议更加简单和更容易实现。
  - 在传输文件时还可以利用控制连接（例如，客户发送请求终止传输）。


## FTP的文件传输过程

- 先建立控制连接（客户端发起）；

- 接下来建立数据连接；

- 最后是文件传输。

- 当数据传输完成后，先断开数据连接；

- FTP会话结束后，断开控制连接。

- 图示

  - 

    ![img](https://mubu.com/document_image/0f8c8b86-462f-474b-ab95-70a9f6fcd20f-4644403.jpg)