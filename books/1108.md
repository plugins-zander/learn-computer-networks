# TCP连接的建立与释放

TCP连接的建立与释放

- TCP的连接有三个阶段，即：连接建立、数据传送和连接释放。

### TCP连接的建立

- TCP连接建立过程中要解决以下三个问题

  - （1）要使每一方能够确知对方的存在。
  - （2）要允许双方协商一些参数（如最大报文段长度、最大窗口大小、服务质量等）。
  - （3）能够对实体资源（如缓存大小、连接表中的项目等）进行分配。

- 客户服务器方式

  - TCP 连接的建立都是采用客户服务器方式。
  - 主动发起连接建立的应用进程叫做客户(client)。
  - 被动等待连接建立的应用进程叫做服务器(server)。

- 用三次握手建立 TCP 连接 

  - 

    ![img](https://mubu.com/document_image/8a0b4238-41b7-45cb-bb7a-0cacaf33b307-4644403.jpg)

    ![img](https://mubu.com/document_image/359fe23e-f116-4c21-a321-a42b5f45d43e-4644403.jpg)

    ![img](https://mubu.com/document_image/37de0bc9-de3d-4a75-921a-a29b68a40d80-4644403.jpg)

    ![img](https://mubu.com/document_image/2ef77f0a-1204-4394-b5fc-c4a482957b8b-4644403.jpg)

- 用三次握手建立 TCP 连接的各状态 

  - 

    ![img](https://mubu.com/document_image/6f89c077-370e-4bdb-9cec-a6555d78ea53-4644403.jpg)

### TCP连接的释放

- 图示

  - 

    ![img](https://mubu.com/document_image/0a8f677c-87fc-4c66-9f65-a3dba46fb5e7-4644403.jpg)

- 四次握手释放连接

  - 

    ![img](https://mubu.com/document_image/a2586406-1f1a-48dd-8c7f-ac1c8770053c-4644403.jpg)

    ![img](https://mubu.com/document_image/41ca0a53-c08e-44c4-8a2d-7aff22d095d4-4644403.jpg)

    ![img](https://mubu.com/document_image/95f5dca0-0310-4fd2-94b8-911359b9295e-4644403.jpg)

    ![img](https://mubu.com/document_image/34e7c572-0bb3-44f0-b132-d4d43314ba63-4644403.jpg)

    ![img](https://mubu.com/document_image/e73e5dce-82c2-45e0-bf98-57e648aa91aa-4644403.jpg)

    ![img](https://mubu.com/document_image/5435a09a-6a32-45a9-8d54-14a2ff93e2fe-4644403.jpg)

- A 必须等待 2MSL 的时间

  - 第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B。
  - 第二，防止 “已失效的连接请求报文段”出现在本连接中。A 在发送完最后一个 ACK 报文段后，再经过时间 2MSL，就可以使本连接持续的时间内所产生的所有报文段，都从网络中消失。这样就可以使下一个新的连接中不会出现这种旧的连接请求报文段。



