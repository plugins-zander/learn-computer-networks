## OSPF路由协议

### OSPF协议概述

开放最短路径优先（ open shortest path first，OSPF）是另一种广泛应用于因特网AS内部的链路状态路由协议。

使用链路状态路由算法

通常用于区域ISP或本地ISP网络，网络规模可以很大

开放(open) 一词是指路由选择协议规范是公众可免费使用的。最短路径优先是因为使用了公开发表的Dijkstra提出的最短路径算法SPF

RFC 2328，适用于IPv4，OSPFv2

RFC 5340，适用于IPv6，OSPFv3

三个要点 

向本自治系统中所有路由器发送信息，这里使用的方法是洪泛法。

发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。

“链路状态”就是说明本路由器都和哪些路由器相邻，以及该链路的“度量”(metric)。 

> 度量可以是如发出返回时长

只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息。  



链路状态数据库(link-state database) 

由于各路由器之间频繁地交换链路状态信息，因此所有的路由器最终都能建立一个链路状态数据库。

这个数据库实际上就是全网的拓扑结构图，它在全网范围内是一致的（这称为链路状态数据库的同步）。

OSPF 的链路状态数据库能较快地进行更新，使各个路由器能及时更新其路由表。OSPF 的更新过程收敛得快是其重要优点。 



OSPF基本特点

（1）支持无类域间路由（CIDR）。

（2）支持区域划分。

（3）无路由自环。

（4）路由变化收敛速度快。

（5）使用IP组播收发协议数据。

（6）支持多条等值路由。

（7）支持协议报文的认证。

> 泛洪相当于是触发的

### OSPF的区域划分

为了使 OSPF 能够用于规模很大的网络，OSPF 将一个自治系统再划分为若干个更小的范围，叫作区域。

每一个区域都有一个 32 位的区域标识符（用点分十进制表示）。

区域也不能太大，在一个区域内的路由器最好不超过 200 个。  



OSPF 划分为两种不同的区域 

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191126093122.png)



划分区域 

划分区域的好处就是将利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个的自治系统，这就减少了整个网络上的通信量。

> 网3坏了，R8不需要知道



在一个区域内部的路由器只知道本区域的完整网络拓扑，而不知道其他区域的网络拓扑的情况。

> 网3想给网8，

OSPF 使用层次结构的区域划分。在上层的区域叫作主干区域(backbone area)。主干区域的标识符规定为0.0.0.0。主干区域的作用是用来连通其他在下层的区域。  



### OSPF协议的报文结构

![img](https://cdn.jsdelivr.net/gh/ZanderZhao/images/img2020/20200115191405.png)

### OSPF 的分组类型

- 类型1，问候(Hello)分组。

- 类型2，数据库描述(Database Description)分组。

- 类型3，链路状态请求(Link State Request)分组。

- 类型4，链路状态更新(Link State Update)分组，

- 用洪泛法对全网更新链路状态。

- 类型5，链路状态确认(Link State Acknowledgment)

- 分组。

- OSPF的基本操作 

  ![img](https://cdn.jsdelivr.net/gh/ZanderZhao/images/img2020/20200115191406.png)

- OSPF 使用的是可靠的洪泛法 

  ![img](https://cdn.jsdelivr.net/gh/ZanderZhao/images/img2020/20200115191407.png)

## 