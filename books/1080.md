# 网络地址转换（NAT）

## 网络地址转换概述

- RFC 1918为私有网络预留了3个IP地址块

- 类别

- 上述3个范围内的地址不会在Internet上被分配，可在公司或企业内部自由使用。

- 但任何以私有IP地址为目标的IP数据报都将被互联网路由器丢弃。

- RFC 1631 IP地址翻译器（IP Network Address Translator，NAT）属于接入广域网(WAN)技术，是一种将私有（保留）地址转化为合法IP地址访问Internet的转换技术

- 核心是将私有地址转换为可以在公网上被路由的公有IP地址，它被广泛应用于各种类型Internet接入方式和各种类型的网络中。

## NAT技术的作用

- 借助于NAT，使用私有保留地址的内部网络通过路由器发送数据包时，私有地址被转换成合法的公用IP地址，一个局域网只需使用少量IP地址（甚至是1个）即可实现私有地址网络内所有计算机与Internet的通信需求。
- 网络地址转换是将IP数据报报头中的IP地址转换为另一个IP地址的过程。
- NAT主要用于实现私有网络访问公共网络的功能。这种通过使用少量的公有IP地址代表较多的私有IP地址的方式有助于减缓可用IP地址空间的枯竭。
- NAT主要用于以下几种情况
  - （1）连接到Internet，但没有足够的合法地址分配给内部主机。
  - （2）更改到一个需要重新分配地址的ISP。
  - （3）有相同的IP地址的两个内部网络合并。
  - （4）想支持负载均衡（主机）。
- NAT的几个相关术语
  - 内部局部地址（Inside Local IP address）
    - 指定内部网络的主机地址，全局唯一，但为私有地址。
  - 内部全局地址（Inside Global IP address）
    - 代表一个或更多内部IP到外部网络的合法IP。
  - 外部全局地址（Outside Global IP address）
    - 外部网络主机的合法IP。
  - 外部局部地址（Outside Local IP address）
    - 外部网络的主机地址，看起来是内部网络的私有地址。
  - 简单转换入口（Simple Translation Entry）
    - 映射IP地址到另一个地址的入口。
  - 扩展转换入口（Extended Translation Entry）
    - 映射IP地址和端口到另一个匹配的IP地址和端口的入口。

## NAT的工作原理

- 外部主机向虚拟主机（定义为内部全局地址）通信

- NAT路由器接受外部主机的请求并依据NAT表建立与内部主机的连接，把内部全局地址（目的地址）翻译成内部局部地址，并转发数据包到内部主机，内部主机接收包并作出响应。

- NAT路由器再使用内部局部地址和端口查询数据表，根据查询到的外部地址和端口作出响应。

- ISP使用NAT技术的结构

  - 

    ![img](https://cdn.jsdelivr.net/gh/ZanderZhao/images/img2020/20200115191633.png)

    ![img](https://cdn.jsdelivr.net/gh/ZanderZhao/images/img2020/20200115191634.png)

## NAT技术的实现方式

- 静态转换
- 动态转换
- 端口多路复用