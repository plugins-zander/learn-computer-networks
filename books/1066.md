# 以太网技术

## 概述

以太网（Ethernet）是一种产生较早且使用相当广泛的局域网，由美国Xerox（施乐）公司的Palo Alto研究中心（简称为PARC）于20世纪70年代初期开始研究并于1975年研制成功。

1980年9月，美国DEC、Intel与Xerox三家公司联合提出了10 Mbps的第一个以太网规范版本，简称DIX Ethernet V1

1982年又修改为第二版规范（实际上也就是最后的版本），即DIX Ethernet V2，成为世界上第一个局域网产品的规范。

以太网与IEEE802.3

DIX Ethernet V2

IEEE 的 802.3 标准

DIX Ethernet V2 标准与 IEEE 的 802.3 标准只有很小的差别，可以将 802.3 局域网简称为“以太网”。严格说来，“以太网”应当是指符合 DIX Ethernet V2 标准的局域网  



## MAC地址



在局域网中，硬件地址又称为物理地址或MAC地址（因为这种地址用在MAC帧中）。IEEE 802标准为局域网规定了一种48位的全球地址（一般都简称为“地址”)，是局域网中每一台计算机（广义计算机，如手机）固化在网卡ROM中的地址。

数据链路层才看mac地址

![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105211546.png)

MAC地址格式



### 48 位的 MAC 地址



IEEE 的注册管理机构 RA 负责向厂家分配地址字段的前三个字节(即高位 24 位)。

地址字段中的后三个字节(即低位 24 位)由厂家自行指派，称为扩展标识符，必须保证生产出的适配器没有重复地址。

一个地址块可以生成224个不同的地址。这种 48 位地址称为 MAC-48，它的通用名称是EUI-48。“MAC地址”实际上就是适配器地址或适配器标识符EUI-48。



![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105211648.png)

win使用ipconfig /all获取本地连接MAC地址

linux可使用下列命令查看

```
ifconfig -a
```



![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105212629.png)



win通过本地连接详细信息查看主MAC地址





### IP地址和MAC地址

1. 对于网络上的某一设备，如一台计算机或一台路由器，其**IP地址是基于网络拓扑设计**出的，同一台设备或计算机上，改动IP地址是很容易的（但必须唯一），而**MAC则是生产厂商烧录好**的，一般不能改动。
2. 长度不同。IP地址为32位，MAC地址为48位。
3. 分配依据不同。IP地址的分配是基于网络拓扑，MAC地址的分配是基于制造商。
4. 寻址协议层不同。





![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105212749.png)



以太网MAC帧格式







![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105213328.png)



以太网 V2 的 MAC 帧格式



### IEEE 802.3标准规定的无效MAC帧



（1）数据字段的长度与长度字段的值不一致；

（2）帧的长度不是整数个字节；

（3）用收到的帧检验序列 FCS 查出有差错；

（4）数据字段的长度不在 46～1500 字节之间。考虑到MAC帧首部和尾部的长度共有18字节，可以得出有效的MAC帧长度为64～1518字节之间。

对于检查出的无效MAC帧就简单地丢弃。以太网不负责重传丢弃的帧。



### IEEE 802.3 CSMA/CD协议



#### 1.CSMA/CD的工作原理

CSMA/CD（Carrier Sense Multiple Access with collision detection，载波监听多路访问/碰撞检测）协议是IEEE 802.3在传统共享式以太网中一种共享传输介质的介质访问控制方法。使用的介质访问控制从逻辑上划分为两部分：介质访问控制子层（MAC）和物理层。



所有结点都共享网络传输信道，结点在发送数据之前，首先检测信道是否空闲，如果信道空闲则发送，否则就等待；在发送出信息后，再对冲突进行检测，当发现冲突时，则取消发送。



CSMA/CD介质访问控制方法

先听后发

边发边听

冲突停止

延迟重发

```
对CSMA/CD协议的工作原理补充说明

（1）“多路访问”说明是总线网络，许多计算机以多点接入的方式连接在一根总线上。协议的实质是“载波监听”和“碰撞检测”。
（2）“载波监听”是指每一个结点在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。也就是前面所说的“先听后发”，一般采用称为载波侦听的技术，即一个结点在传输前先听信道，如果另一个结点正向信道上发送帧，结点则继续等待并侦听信道。如果侦听到该信道是空闲的，该结点则开始数据帧传输；否则，该结点将继续重复这个过程。
（3）“碰撞检测”，也称为“冲突检测”。就是边发边听和冲突停止。发送数据的结点采用称为碰撞检测的技术，边发送数据边检测信道上的信号电压大小，当一个结点检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个结点同时在发送数据，表明产生了碰撞，就要立即停止发送，免得继续浪费网络资源。
（4）在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。产生冲突并检测到冲突的两个结点不能直接进入下一次的载波监听环节，而是要等待一段随机时间后再尝试下一次传输。这个过程指的就是“延迟重发”阶段。

```





![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105213637.png)



CSMA/CD协议发送端的工作流程

![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105213652.png)

CSMA/CD协议接收端工作流程









以太网还采取了一种叫做冲突强化的措施



![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105213758.png)





帧间最小间隔 

帧间最小间隔为 $9.6 \mu s$ ，相当于 96 bit 的发送时间。

一个站在检测到总线开始空闲后，还要等待 $9.6 \mu s$ 才能再次发送数据。

这样做是为了使刚刚收到数据帧的站的接收缓存来得及清理，做好接收下一帧的准备。 



#### 2.冲突及解决

虽然我们通过多路访问和载波监听以及碰撞检测的措施解决了介质的共享问题，但还有几个疑问：

①为什么会产生冲突？

```
当某个站监听到总线是空闲时，也可能总线并非真正是空闲的。 
A 向 B 发出的信息，要经过一定的时间后才能传送到 B。
B 若在 A 发送的信息到达 B 之前发送自己的帧(因为这时 B 的载波监听检测不到 A 所发送的信息)，则必然要在某个时间和 A 发送的帧发生碰撞。
碰撞的结果是两个帧都变得无用。 
电磁波在总线上的有限传播速率的影响 （传播时延）

```



②如果冲突在某种情况下是不可避免的，那发送数据的结点最多经过多少时间可以知道是否产生了冲突（即检测到冲突的时间）？



![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105214132.png)

![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105214213.png)

- 在$t=0$时，A检测到信道为空闲，开始发送数据。而也B检测到信道为空闲。
- 在 $t=\tau - \delta$ 时（   $0<\delta<\tau$    ）， A发送的数据还没有到达B，由于B检测到信道是空闲，因此B也开始发送数据。
- 经过  $\frac{\delta}{2}$时间 后，即在$t=\tau-\frac{\delta}{2}$时，A发送的数据和B发送的数据发生了碰撞。但这时A和B都不知道发生了碰撞。
- 在$   t=\tau     $时，B检测到发生了碰撞，于是停止发送数据。
- 在 $t=2\tau - \delta$  时，A也检测到发生了碰撞，因而也停止发送数据。
- A和B均发送数据失败，都要推迟一段时间再重新发送。





- 争用期:

最先发送数据帧的站，在发送数据帧后至多经过时间 $2\tau$（两倍的端到端传播时延）就可知道发送的数据帧是否遭受了碰撞。

以太网的端到端传播时延 $2\tau$称为争用期，或碰撞窗口。

经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。   

- 争用期的长度 

以太网取 51.2 $\mu s$ 为争用期的长度。

对于 10 Mb/s 以太网，在争用期内可发送512 bit，即 64 字节。

以太网在发送数据时，若前 64 字节没有发生冲突，则后续的数据就不会发生冲突。  



- 最短有效帧长 

如果发生冲突，就一定是在发送的前 64 字节之内。 

由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于 64 字节。 

以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧。 





③结点检测到冲突后，除了冲突停止，还要延迟重发，就是要等待一段随机时间后再重新尝试，那么等待的随机时间是如何确定？

发生碰撞的结点在停止数据发送后，不是立即再发送数据，而是延迟等待一个随机的时间。延迟重传是为了减小再次发生冲突的概率。





#### 3.CSMA/CD协议的要点

（1）适配器从网络层获得一个分组，加上以太网的首部和尾部组成以太网帧，放入适配器的缓存中，准备发送。

（2）若适配器检测到信道空闲（即在96比特时间内没有检测到信道上有信号），就发送。若检测到信道忙，则继续检测并等待信道转为空闲（加上96比特时间），然后发送。

（3）在发送过程中继续检测信道，若一直未检测到碰撞，就顺利把这个帧成功发送完毕。若检测到碰撞，则中止数据的发送，并发送冲突加强信号。

（4）在中止发送后，执行二进制指数退避算法，等待r倍的512比特时间后，返回到步骤(2)。





## 10Mbps以太网



```
10BASE-T 中每个站到集线器的距离不超过 100 m。
这种 10 Mb/s 速率的非屏蔽双绞线星形网结构，既降低了成本，又提高了可靠性。 
10BASE-T 双绞线以太网的出现，是局域网发展史上的一个非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢固的基础。 
```



![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105215726.png)

以太网的四种不同物理层





速率达到或超过 100 Mb/s 的以太网称为高速以太网。

在双绞线上传送 100 Mb/s 基带信号的星型拓扑以太网，仍使用 IEEE 802.3 的CSMA/CD 协议。100BASE-T 以太网又称为快速以太网(Fast Ethernet)。 

100BASE-T 以太网的特点

+ 在全双工方式下工作而无冲突发生。因此，不使用 CSMA/CD 协议。
+ MAC 帧格式仍然是 802.3 标准。
+ 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m。
+ 帧间时间间隔从原来的 9.6 $\mu s$改为现在的 0.96 $\mu s$。    





### 三种不同的物理层标准(IEEE 802.3u)

+ 100BASE-TX
  + 使用 2 对 UTP 5 类线或屏蔽双绞线 STP。  
+ 100BASE-FX 
  + 使用 2 对光纤。 
+ 100BASE-T4
  + 使用 4 对 UTP 3 类线或 5 类线。 





双绞线绕对的排列顺序

| 引脚顺序 | 介质直接连接信号 | EIA/TIA-568A布线标准         | EIA/TIA-568B布线标准         |
| -------- | ---------------- | ---------------------------- | ---------------------------- |
|          |                  | 绿蓝橙棕，三五对调，混色在前 | 橙蓝绿棕，三五对调，混色在前 |
| 1        | TX+（传输）      | 绿白                         | 桔白                         |
| 2        | TX-（传输）      | 绿                           | 桔                           |
| 3        | RX+（接收）      | 桔白                         | 绿白                         |
| 4        | 没有使用         | 蓝                           | 蓝                           |
| 5        | 没有使用         | 蓝白                         | 蓝白                         |
| 6        | RX-（接收）      | 桔                           | 绿                           |
| 7        | 没有使用         | 棕白                         | 棕白                         |
| 8        | 没有使用         | 棕                           | 棕                           |



直通双绞线

两端同时用TIA/EIA-568A，或者TIA/EIA-568B标准，用于不同设备的连接，如PC机到集线器、交换机的连接，交换机到路由器的连接等





交叉双绞线

双绞线一端遵循568A，另一端遵循568B标准

交换机普通端口与交换机普通端口之间或计算机网卡与计算机网卡之间直接相连

现在也可以计算机网卡与计算机网卡之间直接相同568A568A相连，机器自己做协议判





![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105232250.png)

交叉双绞线





## 千兆以太网

```
允许在 1 Gb/s 下全双工和半双工两种方式工作。
使用 802.3 协议的帧格式。
在半双工方式下使用 CSMA/CD 协议（全双工方式不需要使用 CSMA/CD 协议）。
与 10BASE-T 和 100BASE-T 技术向后兼容。
```



吉比特以太网的物理层 

```
 1.1000BASE-X（802.3z标准）
        （1）1000BASE-SX。850nm波长
        （2）1000BASE-LX。1300nm波长
        （3）1000BASE-CX 。
 2.1000BASE-T（ 802.3ab标准）
            使用4对5类UTP，传输距离100M。

```



![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105232417.png)





![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105232446.png)

吉比特以太网的配置举例 





## 10吉比特以太网/100吉比特以太网



```
10吉比特以太网
10GE具有如下的特点：
（1）帧格式与10Mbps、100Mbps和1000Mbps以太网的帧格式基本相同；
（2）保留了802.3标准对以太网最小帧长度和最大帧长度的规定；
（3）传输介质不再使用双绞线，只使用光纤。在超过40km的长距离传输中采用光收发器和单模光纤接口，以便能在广域网和城域网的范围内工作；
（4）只工作在全双工，不存在争用问题。由于不使用CSM A／CD协议，传输距离不受冲突检测的限制


```





10GE规范对应的IEEE802标准

| 年份 | 局域网标准   | 以太网规范                                                   |
| ---- | ------------ | ------------------------------------------------------------ |
| 2002 | IEEE802. 3ae | 10GBASE-SR<br />10GBASE-LR<br />10GBASE-ER<br />10GBASE-LX4<br />10GBASE-SW<br />10GBASE-LW<br />10GBASE-EW |
| 2004 | IEEE 802.3ak | 10GBASE -CX4                                                 |
| 2006 | IEEE 802.3an | 10GBASE-T                                                    |
| 2006 | IEEE 802.3aq | 10GBASE-LRM                                                  |
| 2007 | IEEE 802.3ap | 10GBASE-KR<br />10GBASE-KX4                                  |



各类10GE规范的比较

| 应用领域        | 10GE规范     | 使用的传输介质                      | 有效传输距离           |
| --------------- | ------------ | ----------------------------------- | ---------------------- |
| 局域网          | 10GBASE-SR   | 850nm波长多模光纤，50µm直径 OM3光纤 | 300m                   |
| 局域网          | 10GBASE-LR   | 1310nm波长单模光纤                  | 10km                   |
| 局域网          | 10GBASE-LRM  | 62.5µm直径 OM3光纤                  | 260m                   |
| 局域网          | 10GBASE-ER   | 1550nm波长单模光纤                  | 40km                   |
| 局域网          | 10GBASE-ZR   | 1550nm波长单模光纤                  | 80km                   |
| 局域网          | 10GBASE-LX4  | 1310nm波长单模或多模光纤            | 300m(多模)10km（单模） |
| 局域网          | 10GBASE -CX4 | 4对双芯同轴电缆                     | 15m                    |
| 局域网          | 10GBASE-T    | 6类、6a类双绞线                     | 66m(6类)100m（6a类）   |
| 背板以太网      | 10GBASE-KR   | 铜线（串行接口）                    | 1m                     |
| 背板以太网      | 10GBASE-KX4  | 铜线（并行接口）                    | 1m                     |
| SDH/SONET广域网 | 10GBASE-SW   | 850nm波长多模光纤，50µm直径 OM3光纤 | 300m                   |
| SDH/SONET广域网 | 10GBASE-LW   | 1310nm波长单模光纤                  | 10km                   |
| SDH/SONET广域网 | 10GBASE-EW   | 1550nm波长单模光纤                  | 40km                   |
| SDH/SONET广域网 | 10GBASE-ZW   | 1550nm波长单模光纤                  | 80km                   |





 10吉比特以太网的两种物理层 

```
局域网物理层 LAN PHY。局域网物理层的数据率是 10.000 Gb/s。
可选的广域网物理层 WAN PHY。广域网物理层具有另一种数据率，这是为了和所谓的“Gb/s”的 SONET/SDH（即OC-192/STM-64）相连接。
为了使 10 吉比特以太网的帧能够插入到 OC-192/STM-64 帧的有效载荷中，就要使用可选的广域网物理层，其数据率为 9.95328 Gb/s。   

```



## 100吉比特以太网

在10GE标准之后又制订了40GE/100GE（即40吉比特以太网和100吉比特以太网）的局域网标准IEEE 802.3ba-2010，于201 0年6月公布。

IEEE802.3ba 40GE/100GE物理层接口

| 接口类型                 | 描述                                                        | 40GbE | 100GbE | 带宽              |
| ------------------------ | ----------------------------------------------------------- | ----- | ------ | ----------------- |
| 40GBASE-KR4              | 1m 背板线路（backplane）                                    | √     |        | 4X10Gbps          |
| 40GBASE-CR4100GBASE-CR10 | 7m铜线，由4条/10条独立的铜缆通道组成                        | √     | √      | 4X10Gbps10X10Gbps |
| 40GBASE-SR4100GBASE-SR10 | 100m OM3多模光纤，由4条/10条独立的多模光纤通道（850nm）组成 | √     | √      | 4X10Gbps10X10Gbps |
| 40GBASE-LR4              | 10km单模光纤                                                | √     |        | 4X10Gbps          |
| 100GBASE-LR4             | 10km单模光纤，由4个WDM（1310nm，800GHz波长间隔）通道组成    |       | √      | 4X25Gbps          |
| 100GBASE-ER4             | 40km单模光纤，由4个WDM（1310nm， 800GHz波长间隔）通道组成   |       | √      | 4X25Gbps          |







![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20191105232909.png)

以太网演进过程主要变化特征



从以太网的演进过程可以证明

```
（1）可扩展的（速率从10 Mb/s到100 Gb/s）。
（2）灵活的（多种媒体、全／半双工、共享／交换）。
（3）易于安装。
（4）稳健性好。
```







